@inject IConfiguration Configuration
@inject ImperialVip.Services.ICurrencyRateService CurrencyRateService
@{
    var currentLang = ViewContext.RouteData.Values["lang"]?.ToString() ?? "tr";
    var currencyRates = CurrencyRateService.GetRates();
    currencyRates.TryGetValue("TRY", out var rateTry);
    currencyRates.TryGetValue("USD", out var rateUsd);
    currencyRates.TryGetValue("GBP", out var rateGbp);
    var tryVal = rateTry > 0 ? rateTry : 38.27m;
    var usdVal = rateUsd > 0 ? rateUsd : 1.05m;
    var gbpVal = rateGbp > 0 ? rateGbp : 0.83m;
    var controller = ViewContext.RouteData.Values["controller"]?.ToString() ?? "Home";
    var action = ViewContext.RouteData.Values["action"]?.ToString() ?? "Index";
    var routeId = ViewContext.RouteData.Values["id"];
    var nav = new Dictionary<string, string> {
        ["tr"] = "Ana Sayfa|B√∂lgeler|Ara√ßlarƒ±mƒ±z|Rezervasyon|≈ûof√∂rlerimiz|Hakkƒ±mƒ±zda|Galeri|ƒ∞leti≈üim",
        ["de"] = "Startseite|Regionen|Unsere Fahrzeuge|Reservierung|Fahrer|√úber uns|Galerie|Kontakt",
        ["ru"] = "–ì–ª–∞–≤–Ω–∞—è|–†–µ–≥–∏–æ–Ω—ã|–ù–∞—à–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏|–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ|–í–æ–¥–∏—Ç–µ–ª–∏|–û –Ω–∞—Å|–ì–∞–ª–µ—Ä–µ—è|–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        ["en"] = "Home|Regions|Our Vehicles|Reservation|Drivers|About|Gallery|Contact"
    };
    var navItems = (nav.ContainsKey(currentLang) ? nav[currentLang] : nav["tr"]).Split('|');
}
<!DOCTYPE html>
<html lang="@currentLang">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Imperial VIP - Profesyonel VIP Transfer Hizmetleri. Havalimanƒ± transferi, √∂zel ≈üof√∂rl√º ara√ß kiralama." />
    <meta name="theme-color" content="#d4af37" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>@ViewData["Title"] - Imperial VIP</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/imgs/core-img/favicon.ico">
    <link rel="shortcut icon" href="/images/imgs/core-img/favicon.ico">
    
    <!-- DNS Prefetch & Preconnect (Hƒ±z i√ßin kritik!) -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- ANTI-FLASH CSS + PERFORMANCE -->
    <style>
        html, body {
            background-color: #0f172a !important;
            margin: 0;
            padding: 0;
        }
        body {
            opacity: 1;
            transition: none !important;
            will-change: contents;
        }
        /* FLASH Kƒ∞LLER - Transition overlay */
        #transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #0f172a;
            z-index: 999999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease-out;
        }
        #transition-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        /* GPU acceleration for smooth transitions */
        section, .container, img {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        /* Prevent layout shift */
        img {
            content-visibility: auto;
        }
    </style>
    
    <!-- Google Fonts - Preload critical fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"></noscript>
    
    <!-- Bootstrap Icons - Async load -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"></noscript>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
    
    <!-- OKUNABƒ∞Lƒ∞RLƒ∞K - style.css'ten SONRA y√ºklenir, son s√∂z bunundur -->
    <style>
        .services-intro, .services-desc { color: #ffffff !important; }
        .why-choose-card h3, .why-choose-card p { color: #ffffff !important; }
        .section:not(.section-gray) .section-header .section-title,
        .section:not(.section-gray) .section-header .section-description { color: #ffffff !important; }
        .section:not(.section-gray) .section-header .section-label { color: #d4a84b !important; }
        .trust-bar { background: #ffffff !important; }
        .trust-item span { color: #0f172a !important; font-weight: 600 !important; }
    </style>
    
    <!-- Performance hints -->
    <meta name="format-detection" content="telephone=no">
    <script>
        window.IMPERIAL_CURRENCY_RATES = {
            EUR: 1,
            TRY: @(tryVal.ToString(System.Globalization.CultureInfo.InvariantCulture)),
            USD: @(usdVal.ToString(System.Globalization.CultureInfo.InvariantCulture)),
            GBP: @(gbpVal.ToString(System.Globalization.CultureInfo.InvariantCulture))
        };
        window.getImperialCurrency = function() {
            try {
                var o = JSON.parse(sessionStorage.getItem('imperial_currency'));
                return { code: (o && o.code) ? o.code : 'EUR', symbol: (o && o.symbol) ? o.symbol : '‚Ç¨' };
            } catch (e) { return { code: 'EUR', symbol: '‚Ç¨' }; }
        };
        window.convertFromEur = function(amountEur) {
            if (typeof amountEur !== 'number' || isNaN(amountEur)) return 0;
            var rates = window.IMPERIAL_CURRENCY_RATES || { EUR: 1, TRY: 38.27, USD: 1.05, GBP: 0.83 };
            var cur = window.getImperialCurrency();
            var rate = rates[cur.code];
            if (rate == null || rate <= 0) rate = 1;
            return amountEur * rate;
        };
        (function() {
            var lang = document.documentElement.getAttribute('lang') || 'tr';
            function getUrl() { return '/' + lang + '/Home/CurrencyRatesJson?_=' + Date.now(); }
            function applyRates(rates) {
                if (rates && typeof rates === 'object') {
                    window.IMPERIAL_CURRENCY_RATES = rates;
                    window.dispatchEvent(new Event('imperialCurrencyRatesReady'));
                }
            }
            function fetchRates() {
                fetch(getUrl(), { cache: 'no-store', headers: { 'Cache-Control': 'no-cache' } })
                    .then(function(r) { return r.ok ? r.json() : Promise.reject(); })
                    .then(applyRates)
                    .catch(function() {
                        return fetch('/Home/CurrencyRatesJson?_=' + Date.now(), { cache: 'no-store' })
                            .then(function(r) { return r.ok ? r.json() : Promise.reject(); });
                    })
                    .then(function(rates) { if (rates) applyRates(rates); })
                    .catch(function() {});
            }
            fetchRates();
            setInterval(fetchRates, 15000);
        })();
    </script>
</head>
<body>
    <!-- TRANSITION OVERLAY - Flash √∂nleyici -->
    <div id="transition-overlay"></div>
    
    <!-- Header -->
    <header class="header" id="header">
        <nav class="nav container">
            <a asp-controller="Home" asp-action="Index" asp-route-lang="@currentLang" class="nav-logo">
                <img src="/images/imgs/core-img/logo.png" alt="Imperial VIP" class="nav-logo-img" width="180" height="48" />
            </a>

            <div class="nav-menu" id="nav-menu">
                <ul class="nav-list">
                    <li class="nav-item"><a asp-controller="Home" asp-action="Index" asp-route-lang="@currentLang" class="nav-link">@navItems[0]</a></li>
                    <li class="nav-item"><a asp-controller="Home" asp-action="AllRegions" asp-route-lang="@currentLang" class="nav-link">@navItems[1]</a></li>
                    <li class="nav-item"><a asp-controller="Vehicle" asp-action="Index" asp-route-lang="@currentLang" class="nav-link">@navItems[2]</a></li>
                    <li class="nav-item"><a asp-controller="Vehicle" asp-action="Index" asp-route-lang="@currentLang" class="nav-link">@navItems[3]</a></li>
                    <li class="nav-item"><a asp-controller="Home" asp-action="Drivers" asp-route-lang="@currentLang" class="nav-link">@navItems[4]</a></li>
                    <li class="nav-item"><a asp-controller="Home" asp-action="About" asp-route-lang="@currentLang" class="nav-link">@navItems[5]</a></li>
                    <li class="nav-item"><a asp-controller="Home" asp-action="Galeri" asp-route-lang="@currentLang" class="nav-link">@navItems[6]</a></li>
                    <li class="nav-item"><a asp-controller="Home" asp-action="Contact" asp-route-lang="@currentLang" class="nav-link">@navItems[7]</a></li>
                </ul>

                <div class="nav-close" id="nav-close">
                    <i class="bi bi-x"></i>
                </div>
            </div>

            <div class="nav-buttons">
                <div class="currency-selector" id="currencySelector">
                    <button class="currency-btn" id="currencyBtn" aria-label="Para Birimi Se√ßin" title="Para Birimi">
                        <span class="currency-symbol" id="currencySymbol">‚Ç¨</span>
                        <span class="currency-code" id="currencyCode">EUR</span>
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <div class="currency-dropdown" id="currencyDropdown">
                        <button type="button" class="currency-option" data-currency="EUR" data-symbol="‚Ç¨">‚Ç¨ EUR</button>
                        <button type="button" class="currency-option" data-currency="USD" data-symbol="$">$ USD</button>
                        <button type="button" class="currency-option" data-currency="TRY" data-symbol="‚Ç∫">‚Ç∫ TR</button>
                        <button type="button" class="currency-option" data-currency="GBP" data-symbol="¬£">¬£ GBP</button>
                    </div>
                </div>
                <div class="lang-selector">
                    <button class="lang-btn" id="langBtn" aria-label="Dil Se√ßin" title="Dil Se√ßin">
                        <img src="/images/imgs/flags/@(currentLang).jpg" alt="" class="lang-flag-img" width="20" height="14" onerror="this.src='/images/imgs/flags/tr.jpg'" />
                        <span class="lang-current">@currentLang.ToUpperInvariant()</span>
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <div class="lang-dropdown" id="langDropdown">
                        <a href="/tr/@controller/@action@(routeId != null ? "/" + routeId : "")" class="lang-option @(currentLang == "tr" ? "active" : "")"><img src="/images/imgs/flags/tr.jpg" alt="" class="lang-option-flag" width="20" height="14" /> T√ºrk√ße</a>
                        <a href="/de/@controller/@action@(routeId != null ? "/" + routeId : "")" class="lang-option @(currentLang == "de" ? "active" : "")"><img src="/images/imgs/flags/de.jpg" alt="" class="lang-option-flag" width="20" height="14" /> Deutsch</a>
                        <a href="/ru/@controller/@action@(routeId != null ? "/" + routeId : "")" class="lang-option @(currentLang == "ru" ? "active" : "")"><img src="/images/imgs/flags/ru.jpg" alt="" class="lang-option-flag" width="20" height="14" /> –†—É—Å—Å–∫–∏–π</a>
                        <a href="/en/@controller/@action@(routeId != null ? "/" + routeId : "")" class="lang-option @(currentLang == "en" ? "active" : "")"><img src="/images/imgs/flags/en.jpg" alt="" class="lang-option-flag" width="20" height="14" /> English</a>
                    </div>
                </div>
                <a asp-controller="Vehicle" asp-action="Index" asp-route-lang="@currentLang" class="btn btn-primary">
                    <i class="bi bi-calendar-check"></i>
                    <span>@navItems[3]</span>
                </a>
                <div class="nav-toggle" id="nav-toggle">
                    <i class="bi bi-list"></i>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main">
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <a asp-controller="Home" asp-action="Index" asp-route-lang="@currentLang" class="footer-logo">
                        <img src="/images/imgs/core-img/logo.png" alt="Imperial VIP" class="footer-logo-img" width="180" height="48" />
                    </a>
                    <p class="footer-description">
                        Premium VIP transfer hizmetleri ile seyahatlerinizi ayrƒ±calƒ±klƒ± kƒ±lƒ±yoruz. 
                        G√ºvenli, konforlu ve zamanƒ±nda.
                    </p>
                </div>

                <div class="footer-links">
                    <h4>Hƒ±zlƒ± Eri≈üim</h4>
                    <ul>
                        <li><a asp-controller="Home" asp-action="Index" asp-route-lang="@currentLang">Ana Sayfa</a></li>
                        <li><a asp-controller="Vehicle" asp-action="Index" asp-route-lang="@currentLang">Ara√ßlarƒ±mƒ±z</a></li>
                        <li><a asp-controller="Reservation" asp-action="Index" asp-route-lang="@currentLang">Rezervasyon</a></li>
                        <li><a asp-controller="Home" asp-action="About" asp-route-lang="@currentLang">Hakkƒ±mƒ±zda</a></li>
                        <li><a asp-controller="Home" asp-action="Galeri" asp-route-lang="@currentLang">Galeri</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h4>Hizmetler</h4>
                    <ul>
                        <li><a href="#">Havalimanƒ± Transferi</a></li>
                        <li><a href="#">Otel Transferi</a></li>
                        <li><a href="#">VIP Ara√ß Kiralama</a></li>
                        <li><a href="#">≈ûehirler Arasƒ± Transfer</a></li>
                    </ul>
                </div>

                <div class="footer-contact">
                    <h4>ƒ∞leti≈üim</h4>
                    <ul>
                        <li>
                            <i class="bi bi-telephone"></i>
                            <a href="tel:+905303471580">+90 530 347 1580</a>
                        </li>
                        <li>
                            <i class="bi bi-whatsapp"></i>
                            <a href="https://wa.me/905303471580" target="_blank">WhatsApp</a>
                        </li>
                        <li>
                            <i class="bi bi-envelope"></i>
                            <a href="mailto:info@imperialvip.com">info@imperialvip.com</a>
                        </li>
                        <li>
                            <i class="bi bi-geo-alt"></i>
                            <span>ƒ∞stanbul, T√ºrkiye</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; @DateTime.Now.Year Imperial VIP. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
                <div class="footer-social">
                    <a href="#" target="_blank"><i class="bi bi-instagram"></i></a>
                    <a href="#" target="_blank"><i class="bi bi-facebook"></i></a>
                    <a href="#" target="_blank"><i class="bi bi-twitter-x"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Button -->
    <a href="https://wa.me/905303471580" class="whatsapp-float" title="+90 530 347 1580" target="_blank" rel="noopener" aria-label="WhatsApp ƒ∞leti≈üim">
        <i class="bi bi-whatsapp"></i>
    </a>

    <!-- Scripts - Async/Defer for better performance -->
    <script src="~/js/main.js" asp-append-version="true" defer></script>
    
    <!-- INSTANT PAGE LOAD - Prefetch on hover -->
    <script>
    (function() {
        'use strict';
        
        const prefetched = new Set();
        let mousedownTime = 0;
        
        // 1. PREFETCH on hover (100ms delay)
        let prefetchTimer;
        document.addEventListener('mouseover', function(e) {
            const link = e.target.closest('a');
            if (!link || !link.href || prefetched.has(link.href)) return;
            
            const href = link.href;
            if (!href.startsWith(window.location.origin) || href.includes('#')) return;
            
            clearTimeout(prefetchTimer);
            prefetchTimer = setTimeout(() => {
                const prefetchLink = document.createElement('link');
                prefetchLink.rel = 'prefetch';
                prefetchLink.as = 'document';
                prefetchLink.href = href;
                document.head.appendChild(prefetchLink);
                prefetched.add(href);
                
                console.log('‚ö° Prefetched:', href);
            }, 100);
        }, {passive: true});
        
        // 2. INSTANT navigation on mousedown
        document.addEventListener('mousedown', function(e) {
            mousedownTime = Date.now();
            const link = e.target.closest('a');
            if (!link || !link.href) return;
            
            const href = link.href;
            if (!href.startsWith(window.location.origin) || href.includes('#')) return;
            
            if (!prefetched.has(href)) {
                const prefetchLink = document.createElement('link');
                prefetchLink.rel = 'prefetch';
                prefetchLink.href = href;
                document.head.appendChild(prefetchLink);
                prefetched.add(href);
            }
        }, {passive: true});
        
        // 3. INSTANT navigation WITH overlay (NO FLASH!)
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a');
            if (!link || !link.href) return;
            
            const href = link.href;
            if (!href.startsWith(window.location.origin) || href.includes('#')) return;
            
            e.preventDefault();
            const overlay = document.getElementById('transition-overlay');
            overlay.classList.add('active');
            
            setTimeout(() => {
                window.location.href = href;
            }, 150);
        });
        
        // 4. Hide overlay on page load
        window.addEventListener('DOMContentLoaded', function() {
            const overlay = document.getElementById('transition-overlay');
            setTimeout(() => {
                overlay.classList.remove('active');
            }, 100);
        });
        
        // 5. PageShow event (back/forward i√ßin)
        window.addEventListener('pageshow', function(e) {
            const overlay = document.getElementById('transition-overlay');
            overlay.classList.remove('active');
            if (e.persisted) {
                console.log('‚ö° From cache (instant!)');
            }
        });
        
        // 5. AUTO-PRELOAD ALL NAVBAR LINKS
        setTimeout(() => {
            const navLinks = document.querySelectorAll('nav a, .nav-link, .navbar a');
            navLinks.forEach(link => {
                const href = link.href;
                if (href && href.startsWith(window.location.origin) && !href.includes('#') && !prefetched.has(href)) {
                    const prefetchLink = document.createElement('link');
                    prefetchLink.rel = 'prefetch';
                    prefetchLink.href = href;
                    document.head.appendChild(prefetchLink);
                    prefetched.add(href);
                    console.log('üî• Auto-prefetched:', href);
                }
            });
        }, 1000);
        
        console.log('‚ö° INSTANT LOAD: Active');
    })();
    </script>
    @await RenderSectionAsync("Scripts", required: false)
    
    <script>
        if ('fonts' in document) {
            Promise.all([
                document.fonts.load('400 1em Inter'),
                document.fonts.load('600 1em Inter')
            ]).then(() => document.documentElement.classList.add('fonts-loaded'));
        }
    </script>
</body>
</html>
